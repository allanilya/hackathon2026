---
phase: 01-foundation-design-system
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - app/globals.css
  - app/layout.tsx
  - components/providers/SmoothScrollProvider.tsx
  - lib/hooks/usePrefersReducedMotion.ts
autonomous: true

must_haves:
  truths:
    - "Custom colors (burnt-orange, amber, teal, stone scale) are usable as Tailwind utility classes"
    - "Fluid typography renders oversized headings that scale between mobile and desktop viewports"
    - "Lenis smooth scroll is active on page load with buttery-smooth wheel behavior"
    - "GSAP ScrollTrigger fires at correct scroll positions (synchronized via 3-line bridge)"
    - "Animations disable when OS prefers-reduced-motion is set to reduce"
  artifacts:
    - path: "app/globals.css"
      provides: "Design tokens: colors, typography, radii, shadows via @theme directive"
      contains: "--color-burnt-orange"
    - path: "app/layout.tsx"
      provides: "Root layout with Geist font variables and SmoothScrollProvider wrapper"
      contains: "SmoothScrollProvider"
    - path: "components/providers/SmoothScrollProvider.tsx"
      provides: "Client component initializing Lenis + GSAP ScrollTrigger with 3-line bridge"
      contains: "gsap.ticker.lagSmoothing(0)"
    - path: "lib/hooks/usePrefersReducedMotion.ts"
      provides: "SSR-safe React hook for detecting prefers-reduced-motion"
      contains: "prefers-reduced-motion"
  key_links:
    - from: "app/layout.tsx"
      to: "components/providers/SmoothScrollProvider.tsx"
      via: "import and JSX wrapper around {children}"
      pattern: "SmoothScrollProvider"
    - from: "components/providers/SmoothScrollProvider.tsx"
      to: "lenis"
      via: "Lenis constructor + 3-line GSAP bridge in useEffect"
      pattern: "lenis\\.on.*ScrollTrigger\\.update"
    - from: "components/providers/SmoothScrollProvider.tsx"
      to: "prefers-reduced-motion"
      via: "window.matchMedia check before Lenis config"
      pattern: "prefers-reduced-motion"
---

<objective>
Set up the complete design token system in Tailwind CSS v4's @theme directive and build the animation infrastructure (Lenis + GSAP provider with reduced-motion support). Wire everything into the root layout.

Purpose: All design tokens and animation primitives must exist before building any visual sections or components.
Output: globals.css with full @theme tokens, SmoothScrollProvider client component, usePrefersReducedMotion hook, and root layout wiring.
</objective>

<execution_context>
@C:\Users\antoi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\antoi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define design tokens in globals.css @theme directive</name>
  <files>app/globals.css</files>
  <action>
    Update `app/globals.css` to include the full design token system using Tailwind v4's @theme directive. The file should start with `@import "tailwindcss";` (already set from Plan 01), followed by the @theme block.

    Add these tokens inside `@theme { }`:

    **Colors:**
    ```
    --color-burnt-orange: #C4501E;
    --color-burnt-orange-hover: #A8431A;
    --color-amber: #D97706;
    --color-teal: #0F766E;
    --color-teal-hover: #0D635C;
    --color-success: #16A34A;
    --color-error: #DC2626;
    ```

    **Stone neutrals (warm scale):**
    ```
    --color-stone-50: #FAFAF9;
    --color-stone-100: #F5F5F4;
    --color-stone-200: #E7E5E4;
    --color-stone-300: #D6D3D1;
    --color-stone-400: #A8A29E;
    --color-stone-500: #78716C;
    --color-stone-600: #57534E;
    --color-stone-700: #44403C;
    --color-stone-800: #292524;
    --color-stone-900: #1C1917;
    --color-stone-950: #0C0A09;
    ```

    **Fluid typography (clamp for oversized headings):**
    ```
    --font-size-display: clamp(3.5rem, 3rem + 2.5vw, 5rem);
    --font-size-5xl: clamp(3rem, 2.5rem + 2.5vw, 4rem);
    --font-size-4xl: clamp(2.25rem, 1.9rem + 1.75vw, 3rem);
    --font-size-3xl: clamp(1.875rem, 1.6rem + 1.375vw, 2.5rem);
    --font-size-2xl: clamp(1.5rem, 1.3rem + 1vw, 2rem);
    --font-size-xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);
    --font-size-lg: clamp(1.125rem, 1rem + 0.625vw, 1.25rem);
    --font-size-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
    --font-size-sm: clamp(0.875rem, 0.8rem + 0.375vw, 1rem);
    --font-size-xs: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem);
    ```

    **Border radius:**
    ```
    --radius-card: 1rem;
    --radius-button: 9999px;
    ```

    **Shadows:**
    ```
    --shadow-card: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-card-hover: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    ```

    After the @theme block, add a reduced-motion media query for CSS-level animation disabling:
    ```css
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
    ```

    Also add base body styles:
    ```css
    body {
      background-color: var(--color-stone-950);
      color: var(--color-stone-100);
    }
    ```

    This gives us a dark default body with light text, matching the premium dark-mode-first aesthetic from the Square reference.
  </action>
  <verify>
    Run `npm run dev`. In browser, inspect any element — custom CSS variables should appear in computed styles.
    Confirm `bg-burnt-orange`, `text-stone-50`, `text-display` etc. work as Tailwind utility classes (add a test element temporarily).
  </verify>
  <done>globals.css contains @theme block with all color, typography, radius, and shadow tokens. Tailwind generates utility classes for all custom tokens. Reduced-motion CSS media query is present.</done>
</task>

<task type="auto">
  <name>Task 2: Create SmoothScrollProvider and usePrefersReducedMotion hook</name>
  <files>components/providers/SmoothScrollProvider.tsx, lib/hooks/usePrefersReducedMotion.ts</files>
  <action>
    Create `lib/hooks/usePrefersReducedMotion.ts`:
    - Mark as `'use client'`
    - Implement the SSR-safe hook pattern from research (Pattern 4)
    - Default to `true` (reduced motion) for SSR safety — animations only enable after hydration confirms no-preference
    - Listen for changes via `addEventListener('change', ...)` on the media query
    - Clean up listener on unmount

    ```typescript
    'use client'
    import { useState, useEffect } from 'react'

    const QUERY = '(prefers-reduced-motion: no-preference)'

    export function usePrefersReducedMotion() {
      const [prefersReducedMotion, setPrefersReducedMotion] = useState(true)

      useEffect(() => {
        const mediaQueryList = window.matchMedia(QUERY)
        setPrefersReducedMotion(!mediaQueryList.matches)

        const listener = (event: MediaQueryListEvent) => {
          setPrefersReducedMotion(!event.matches)
        }

        mediaQueryList.addEventListener('change', listener)
        return () => mediaQueryList.removeEventListener('change', listener)
      }, [])

      return prefersReducedMotion
    }
    ```

    Create `components/providers/SmoothScrollProvider.tsx`:
    - Mark as `'use client'`
    - Import Lenis, gsap, ScrollTrigger, and lenis CSS
    - Register ScrollTrigger plugin at module level (outside component)
    - In useEffect:
      1. Check `prefers-reduced-motion` via `window.matchMedia` (direct check, not the hook — the provider runs once)
      2. Create Lenis instance with `lerp: prefersReducedMotion ? 1 : 0.1` and `smoothWheel: !prefersReducedMotion`
      3. Apply the CRITICAL 3-line bridge:
         - `lenis.on('scroll', ScrollTrigger.update)`
         - `gsap.ticker.add((time) => { lenis.raf(time * 1000) })`
         - `gsap.ticker.lagSmoothing(0)`
      4. Cleanup: `lenis.destroy()` and remove ticker callback
    - Render `<>{children}</>`

    IMPORTANT: Import `'lenis/dist/lenis.css'` — this is required for Lenis features like data-lenis-prevent and stopped states.

    IMPORTANT: The ticker callback needs to be stored in a variable for proper cleanup:
    ```typescript
    const rafCallback = (time: number) => { lenis.raf(time * 1000) }
    gsap.ticker.add(rafCallback)
    // cleanup:
    gsap.ticker.remove(rafCallback)
    ```
  </action>
  <verify>
    Confirm both files exist with `'use client'` directive.
    Confirm SmoothScrollProvider contains all 3 bridge lines.
    Confirm `import 'lenis/dist/lenis.css'` is present.
    Confirm cleanup function destroys lenis and removes ticker.
  </verify>
  <done>SmoothScrollProvider.tsx initializes Lenis with GSAP 3-line bridge and reduced-motion awareness. usePrefersReducedMotion.ts provides SSR-safe hook. Both are client components.</done>
</task>

<task type="auto">
  <name>Task 3: Wire SmoothScrollProvider and Geist fonts into root layout</name>
  <files>app/layout.tsx</files>
  <action>
    Update `app/layout.tsx` to:

    1. Import Geist and Geist_Mono from `next/font/google`
    2. Import SmoothScrollProvider from `@/components/providers/SmoothScrollProvider`
    3. Import `./globals.css`
    4. Configure both fonts with `subsets: ['latin']` and CSS variable names:
       - `--font-geist-sans` for Geist
       - `--font-geist-mono` for Geist_Mono
    5. Apply font variables to `<html>` className
    6. Set `<html lang="en">`
    7. Apply `font-sans antialiased` to `<body>`
    8. Wrap `{children}` with `<SmoothScrollProvider>`

    Add metadata export:
    ```typescript
    export const metadata = {
      title: 'Slider — AI Copilot for PowerPoint',
      description: 'Build professional slide decks with AI-powered Skills. Join the waitlist.',
    }
    ```

    Final structure:
    ```tsx
    import { Geist, Geist_Mono } from 'next/font/google'
    import SmoothScrollProvider from '@/components/providers/SmoothScrollProvider'
    import './globals.css'

    const geistSans = Geist({
      subsets: ['latin'],
      variable: '--font-geist-sans',
    })

    const geistMono = Geist_Mono({
      subsets: ['latin'],
      variable: '--font-geist-mono',
    })

    export const metadata = {
      title: 'Slider — AI Copilot for PowerPoint',
      description: 'Build professional slide decks with AI-powered Skills. Join the waitlist.',
    }

    export default function RootLayout({
      children,
    }: {
      children: React.ReactNode
    }) {
      return (
        <html lang="en" className={`${geistSans.variable} ${geistMono.variable}`}>
          <body className="font-sans antialiased">
            <SmoothScrollProvider>
              {children}
            </SmoothScrollProvider>
          </body>
        </html>
      )
    }
    ```

    NOTE: The `font-sans` utility in Tailwind should resolve to Geist because Next.js 15 with Geist maps `--font-geist-sans` to the font-family. If Tailwind v4 needs explicit mapping, add to @theme in globals.css:
    ```css
    --font-sans: var(--font-geist-sans);
    --font-mono: var(--font-geist-mono);
    ```
  </action>
  <verify>
    Run `npm run dev`. Page should load without errors.
    Browser should show smooth scrolling behavior (add enough content to page.tsx to enable scrolling if needed).
    Open DevTools > Elements: `<html>` should have font variable classes, `<body>` should have `font-sans antialiased`.
    Check document title is "Slider — AI Copilot for PowerPoint".
  </verify>
  <done>Root layout uses Geist fonts via next/font, wraps content in SmoothScrollProvider, has proper metadata. Smooth scrolling is active on the page.</done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Custom CSS variables visible in browser DevTools (--color-burnt-orange, --font-size-display, etc.)
3. Tailwind utilities work: `bg-burnt-orange`, `text-stone-50`, `text-display`, `rounded-card`, `rounded-button`
4. Page has smooth scroll behavior (buttery wheel scrolling, not native)
5. Font renders as Geist Sans (check DevTools computed font-family)
6. Page title shows "Slider — AI Copilot for PowerPoint"
7. With OS reduced-motion enabled: scroll is instant (no smooth interpolation)
</verification>

<success_criteria>
- Full color palette available as Tailwind utilities
- Fluid typography scale renders oversized headings correctly
- Lenis smooth scroll active with GSAP ScrollTrigger synchronized
- Animations respect prefers-reduced-motion
- Geist font applied via next/font optimization
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-02-SUMMARY.md`
</output>
